# systech-aidd-test

AI-driven Telegram бот для тестирования интеграции с LLM через OpenRouter API.

## Описание

Простой MVP Telegram бота с поддержкой общения через различные LLM модели. Проект следует принципам KISS и создан для быстрой проверки концепции.

## Технологии

- **Python 3.11+** - основной язык
- **uv** - управление зависимостями
- **aiogram 3.x** - Telegram Bot API (polling)
- **openai** - клиент для работы с LLM через OpenRouter
- **python-dotenv** - управление конфигурацией

## Быстрый старт

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd systech-aidd-test
```

### 2. Установка зависимостей

Убедитесь, что у вас установлен [uv](https://github.com/astral-sh/uv):

```bash
make install
```

или

```bash
uv sync --all-extras
```

### 3. Настройка конфигурации

Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

Отредактируйте `.env` и укажите ваши токены:

```ini
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# OpenRouter API
OPENROUTER_API_KEY=sk-or-v1-your_key_here
OPENROUTER_MODEL=anthropic/claude-3.5-sonnet
```

**Где получить токены:**
- Telegram Bot Token: [@BotFather](https://t.me/botfather) в Telegram
- OpenRouter API Key: [openrouter.ai](https://openrouter.ai/)

### 4. Запуск бота

```bash
make run
```

или

```bash
uv run python src/main.py
```

Бот запустится в режиме polling и начнет обрабатывать сообщения.

## Доступные команды

### Команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать список команд
- `/status` - Проверить работоспособность бота
- `/reset` - Очистить контекст диалога

### Команды разработки

```bash
make install   # Установка зависимостей
make run       # Запуск бота
make lint      # Проверка кода линтером
make format    # Форматирование кода
make test      # Запуск тестов с покрытием кода
make clean     # Очистка кэша и временных файлов
make help      # Показать все доступные команды
```

## Структура проекта

```
systech-aidd-test/
├── docs/                  # Документация
│   ├── ADR.md            # Architecture Decision Records
│   ├── IDEA.md           # Описание идеи
│   ├── VISION.md         # Техническое видение
│   └── TASKLIST.md       # План разработки
├── src/                   # Исходный код
│   ├── __init__.py
│   ├── main.py           # Точка входа
│   ├── bot.py            # TelegramBot класс
│   ├── llm_client.py     # LLMClient класс
│   ├── config.py         # Config класс
│   └── logger.py         # Logger настройка
├── tests/                 # Тесты
│   ├── __init__.py
│   ├── test_config.py
│   ├── test_logger.py
│   ├── test_llm_client.py
│   └── test_bot.py
├── logs/                  # Логи (создается автоматически)
├── .env.example          # Пример конфигурации
├── .env                  # Конфигурация (не в git)
├── .gitignore
├── Makefile              # Команды управления
├── pyproject.toml        # Конфигурация uv
└── README.md
```

## Разработка

### Принципы

- **KISS** - максимальная простота решений
- **ООП** - один класс = один файл
- **Читаемость** - код должен быть самоочевидным
- **Асинхронность** - весь код использует async/await

Подробнее см. `.cursor/rules/conventions.mdc` и `docs/VISION.md`

### Линтинг, форматирование и тестирование

Проект использует [ruff](https://github.com/astral-sh/ruff) для линтинга и форматирования:

```bash
make lint      # Проверка кода
make format    # Автоформатирование
```

Для тестирования используется [pytest](https://pytest.org):

```bash
make test      # Запуск тестов с покрытием кода
```

Тесты включают:
- Юнит-тесты для Config, Logger, LLMClient, TelegramBot
- Покрытие кода с отчетом
- Асинхронные тесты с pytest-asyncio

## Логирование

Логи записываются в:
- `logs/bot.log` - файл с полной историей
- Консоль - для мониторинга в реальном времени

Формат лога:
```
2025-10-10 12:00:00 - systech_bot - INFO - Сообщение
```

## Текущий статус

**Итерация 1** (✅ Завершено) - Базовая настройка и Telegram бот  
**Итерация 2** (✅ Завершено) - Интеграция с LLM через OpenRouter  
**Итерация 3** (✅ Завершено) - Контекст диалога (последние 20 сообщений)  
**Итерация 4** (✅ Завершено) - Финализация, тестирование и документация  

См. подробный план в `docs/TASKLIST.md`

## Возможности

✅ **Полностью реализовано:**
- Интеграция с LLM через OpenRouter API
- Поддержка различных моделей (Claude, GPT и др.)
- Запоминание контекста диалога (последние 20 сообщений)
- Команда `/reset` для очистки контекста
- Обработка edge cases (пустые/длинные сообщения)
- Дружественные сообщения об ошибках
- Юнит-тесты с покрытием кода
- Асинхронная архитектура

⚠️ **Известные ограничения:**
- История диалогов хранится в памяти (сбрасывается при перезапуске)
- Нет персистентного хранилища (in-memory для MVP)
- Максимум 20 сообщений в контексте на пользователя

## Лицензия

Проект создан для внутреннего использования и тестирования.

## Контакты

Для вопросов и предложений обращайтесь к команде разработки.

