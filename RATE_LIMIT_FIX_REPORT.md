# Rate Limit (429) - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–æ—Ç–∞ –∏ API –ø–æ–ª—É—á–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞:

```
Error code: 429 - {'error': {'message': 'Rate limit exceeded: free-models-per-day. Add 10 credits to. Please try again with a simpler question.'}}
```

### –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?

- **–ö–æ–¥ 429** - HTTP –æ—à–∏–±–∫–∞ "Too Many Requests" (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤)
- **`free-models-per-day`** - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **–±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å** –Ω–∞ OpenRouter.ai
- **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ** - –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ —Å—á—ë—Ç OpenRouter –ª–∏–±–æ –¥–æ–∂–¥–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è (–ª–∏–º–∏—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 00:00 UTC)

---

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ OpenRouter üí≥

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://openrouter.ai
2. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –Ω–∞ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
3. –ù–∞–∂–∞—Ç—å –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å (–≤–µ—Ä—Ö —Å–ø—Ä–∞–≤–∞)
4. –í—ã–±—Ä–∞—Ç—å **"Credits"** –∏–ª–∏ **"Billing"**
5. –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã (–º–∏–Ω–∏–º—É–º $5-10)
6. –ü–æ—Å–ª–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∏–º–∏—Ç —Å—Ä–∞–∑—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–∂–¥–∞—Ç—å—Å—è —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞ ‚è∞

- –°—É—Ç–æ—á–Ω—ã–π –ª–∏–º–∏—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ (–≤ 00:00 UTC)
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Å–µ–≥–æ–¥–Ω—è - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≤—Ç—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã üìù

–ß—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ª–∏–º–∏—Ç:

**‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ (–¥–æ–ª–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã):**
```
"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥,
—Å–¥–µ–ª–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å
–ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫"
```

**‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ (–∫–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã):**
```
"–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?"
"–ö–∞–∫–∏–µ —Å–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ –Ω–µ–¥–µ–ª—é?"
"–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π?"
```

---

## –£–ª—É—á—à–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (LLMClient)

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å `RateLimitExceededError`
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∏–ø–∞ –ª–∏–º–∏—Ç–∞ (free-daily vs standard)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –ª–æ–≥–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏
- ‚úÖ **NO RETRY –ø—Ä–∏ free-models-per-day** - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É ‚úã
- ‚úÖ Retry —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –ª–∏–º–∏—Ç–æ–≤ (–µ—Å–ª–∏ –æ–Ω–∏ –±—É–¥—É—Ç)
- ‚úÖ Exponential backoff –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ (1s, 2s, 4s, 8s...)

```python
# –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
if is_free_limit:
    # –í—ã–±—Ä–æ—Å–∏—Ç—å –°–†–ê–ó–£ - retry –Ω–µ –ø–æ–º–æ–∂–µ—Ç
    raise RateLimitExceededError(error_msg)
else:
    # –î–ª—è –¥—Ä—É–≥–∏—Ö –ª–∏–º–∏—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å retry
    for attempt in range(max_retries + 1):
        # ... retry –ª–æ–≥–∏–∫–∞ —Å backoff
```

### 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (ChatService)

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `RateLimitExceededError`
- ‚úÖ –î—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ **–ù–µ—Ç –æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è –Ω–∞ retry** - –æ—à–∏–±–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

```python
except RateLimitExceededError as e:
    error_message = (
        "üö´ API Rate Limit Exceeded\n\n"
        "The free tier usage limit has been exceeded. "
        "To continue using the service, please:\n"
        "1. Add credits to your OpenRouter account\n"
        "2. Wait until tomorrow (daily limits reset)\n"
        "3. Use a simpler query to reduce processing time\n\n"
        f"Details: {str(e)[:150]}"
    )
    yield error_message
```

---

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `src/llm_client.py` | ‚úÖ –£–¥–∞–ª–µ–Ω retry –ø—Ä–∏ free-models-per-day, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É |
| `src/api/chat_service.py` | ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ rate limit, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è |

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ `logs/bot.log` - —Ç–∞–º –±—É–¥—É—Ç –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ—à–∏–±–∫–∏:
```
ERROR: Rate limit exceeded: free-models-per-day.
       Add credits or wait until tomorrow (00:00 UTC).
       Error: ...
```

2. –ü—Ä–∏ –æ—à–∏–±–∫–µ 429 —Å free-models-per-day:
```python
# Retry –ù–ï –ë–£–î–ï–¢ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å
# –ë—É–¥–µ—Ç —Å—Ä–∞–∑—É –≤—ã–±—Ä–æ—à–µ–Ω–∞ RateLimitExceededError
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```

### –î–ª—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ï—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω–∞ –æ—à–∏–±–∫–∞:

```
üö´ API Rate Limit Exceeded

The free tier usage limit has been exceeded.
To continue using the service, please:
1. Add credits to your OpenRouter account
2. Wait until tomorrow (daily limits reset)
3. Use a simpler query to reduce processing time
```

**–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤—ã—à–µ (–í–∞—Ä–∏–∞–Ω—Ç 1-3)**

---

## OpenRouter Free Tier –õ–∏–º–∏—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –≤ –¥–µ–Ω—å** | ~30-50 –∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏) |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å —Å–≤–µ—Ä—Ö –ª–∏–º–∏—Ç–∞** | –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞ |
| **–°–±—Ä–æ—Å –ª–∏–º–∏—Ç–∞** | –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 UTC |
| **–ü–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏** | –†–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ —Å—É—Ç–æ—á–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ (–ø–ª–∞—Ç—è—Ç—Å—è –∑–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å) |

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ ‚úÖ
1. **–î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤—Ç—Ä–∞** - –ª–∏–º–∏—Ç —Å–±—Ä–æ—Å–∏—Ç—Å—è
2. **–î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã** - $5 –¥–æ–ª–∂–Ω–æ —Ö–≤–∞—Ç–∏—Ç—å –Ω–∞ –Ω–µ–¥–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–µ üîß
1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (–±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–µ)
2. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mock API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ üìä
1. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Anthropic, OpenAI, Google)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –î–æ–±–∞–≤–∏—Ç—å queue –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **OpenRouter Docs**: https://openrouter.ai/docs
- **Rate Limit Details**: https://openrouter.ai/docs#rate-limits
- **Billing Info**: https://openrouter.ai/account/billing/overview
