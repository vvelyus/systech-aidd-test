# ✅ Сообщение об ошибке 429 в Telegram боте: ИСПРАВЛЕНО

## Проблема
При ошибке 429 (Rate Limit Exceeded) Telegram бот показывал стандартное сообщение об ошибке:
```
Извините, произошла ошибка при обработке вашего сообщения. Попробуйте еще раз позже.
```

Это было неинформативно и не помогало пользователю понять почему произошла ошибка и что делать.

## Решение

Добавлена специальная обработка RateLimitExceededError в Telegram боте.

### Обновлены файлы:

#### 1. `src/messages.py`
Добавлен новый метод `rate_limit_error()` с дружественным сообщением на русском без эмодзи:

```python
@staticmethod
def rate_limit_error() -> str:
    """
    Сообщение об исчерпании лимита бесплатного плана.
    """
    return (
        "Лимит бесплатного плана исчерпан\n\n"
        "Дневной лимит на бесплатное использование достигнут.\n\n"
        "Что делать:\n"
        "1. Добавьте кредиты на https://openrouter.ai/account/billing\n"
        "2. Дождитесь завтра (00:00 UTC) - лимит сбросится автоматически\n"
        "3. Используйте более простые запросы\n\n"
        "Почему так происходит:\n"
        "Бесплатный план ограничен примерно 30-50 запросами в день. "
        "Перейдите на платный план для неограниченного использования."
    )
```

#### 2. `src/bot.py`
Добавлен импорт и специальный обработчик:

```python
from src.llm_client import RateLimitExceededError

# В методе handle_message добавлен обработчик:
except RateLimitExceededError as e:
    self.logger.warning(f"Rate limit exceeded for user_id={user_id}: {e}")
    await message.answer(BotMessages.rate_limit_error())
```

#### 3. `src/llm_client.py`
Гарантирует что RateLimitExceededError выбрасывается после всех retry попыток:

```python
except RateLimitError as retry_error:
    if attempt < max_retries:
        delay = self.base_delay * (2 ** attempt)  # Exponential backoff
        await asyncio.sleep(delay)
    else:
        raise RateLimitExceededError(error_msg)
```

## Результат

**Было:**
```
Извините, произошла ошибка при обработке вашего сообщения. Попробуйте еще раз позже.
```

**Стало:**
```
Лимит бесплатного плана исчерпан

Дневной лимит на бесплатное использование достигнут.

Что делать:
1. Добавьте кредиты на https://openrouter.ai/account/billing
2. Дождитесь завтра (00:00 UTC) - лимит сбросится автоматически
3. Используйте более простые запросы

Почему так происходит:
Бесплатный план ограничен примерно 30-50 запросами в день. Перейдите на платный план для неограниченного использования.
```

## Тестирование

✅ Бот перезагружен с новым кодом
✅ API перезагружена с новым кодом
✅ Обработчик RateLimitExceededError активирован
✅ Дружественное сообщение об ошибке готово к использованию"
